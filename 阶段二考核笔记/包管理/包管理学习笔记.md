# 包管理学习笔记

------

## 一、包管理是什么？

<u>包管理是指使用工具来自动化管理项目所依赖的**功能模块（即“包”）**。</u>
它能帮助我们快速安装、更新、卸载、锁定和统一依赖版本，是现代前端和 Node.js 项目开发的基础设施。

包管理工具解决的问题包括：

- 安装包及其依赖
- 统一团队使用的依赖版本
- 管理依赖版本升级
- 清理不再使用的包
- 离线缓存、镜像加速等性能优化

常见工具有：npm、yarn、pnpm、cnpm（镜像工具）

------

## 二、npm（Node Package Manager）

- **Node.js 官方推荐并自带的包管理器**
- 使用中央仓库 registry.npmjs.org
- 使用 `package-lock.json` 锁定依赖版本
- **==安装速度一般，依赖结构扁平==**

常用命令：

```bash
npm init
npm install <包名>
npm uninstall <包名>
npm run <script>
```

- 安装默认写入 `dependencies` 字段
- 支持全局安装（带 -g）
- 默认允许幽灵依赖（未声明但可使用）
  * 何用？

------

## 三、yarn（？**Yet Another Resource Negotiator**）

- **由 Facebook 开发，提升 npm 的安装速度和一致性**
- 使用 `yarn.lock` 锁定版本
- **==支持缓存、离线安装、工作区（Workspaces）==**

常用命令：

```bash
yarn init
yarn add <包名>
yarn remove <包名>
yarn run <script>
```

- `yarn` 默认自动读取并安装 package.json 中的依赖
- **相比 npm 更快，操作反馈更清晰**
- yarn v1 和 v2（berry）版本之间差异很大

------

## 四、pnpm（Performant NPM）

- **==新一代高性能==包管理器，主打速度和磁盘优化**
- 使用硬链接将依赖共享到多个项目
- 强制依赖显式声明，避免幽灵依赖

常用命令：

```bash
pnpm init
pnpm add <包名>
pnpm remove <包名>
pnpm run <script>
```

- 使用 `pnpm-lock.yaml` 记录锁定信息
- 所有包实际存储在全局缓存中，用软/硬链接挂载到项目
- **==更适合大型项目==和 monorepo 架构**

------

## 五、三者区别

| 特性           | npm               | yarn       | pnpm             |
| -------------- | ----------------- | ---------- | ---------------- |
| 锁定文件       | package-lock.json | yarn.lock  | pnpm-lock.yaml   |
| 安装速度       | 一般              | 快         | **很快**         |
| 空间占用       | **高**            | 中         | 低（硬链接共享） |
| 幽灵依赖容忍度 | 宽松              | 一般       | 严格             |
| 工作区支持     | 有（较弱）        | 有（良好） | 有（**强**）     |
| 生态成熟度     | **高**            | **高**     | 正在上升         |

**总结：**

- npm：默认选项，广泛兼容，生态最大
- yarn：适合追求速度和一致性的团队
- pnpm：适合大型项目，依赖管理更严格、结构更清晰

------

## 六、文件结构（以 pnpm 为例）

```
my-project/
├── node_modules/           # 链接目录（pnpm 并不真正安装到这里）
├── pnpm-lock.yaml          # 锁定依赖版本
├── package.json            # 项目依赖描述
└── src/
    └── index.js
```

其他工具结构类似，只是对 node_modules 的处理方式不同。

**注意：**

- pnpm 不直接在 node_modules 中存放文件，而是链接到全局 store
- yarn 和 npm 使用传统的扁平结构安装所有依赖

------

## 七、配置 package.json

package.json 是项目依赖和脚本的配置清单，包含：

```json
{
  "name": "demo",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "vite build"
  },
  "dependencies": {
    "vue": "^3.4.0"
  },
  "devDependencies": {
    "vite": "^5.0.0"
  },
  "engines": {
    "node": ">=18.0.0"
  }
}
```

- dependencies：运行时依赖
- devDependencies：开发时依赖
- scripts：自定义命令（可用 `npm run` 或 `pnpm run` 执行）
- engines：可选，用于限制 node 版本

------

## 八、阿里 npm（镜像加速）

国内访问 npm 官方源速度慢，可以使用阿里镜像：

```bash
npm config set registry https://registry.npmmirror.com
```

也可以安装 nrm 快速切换源：

```bash
npm install -g nrm
nrm ls       # 查看可用源
nrm use npmmirror
```

- cnpm 是阿里维护的 npm 客户端，但它不生成 lock 文件，不建议生产环境使用
- 推荐使用 nrm + 原生 npm/yarn/pnpm 配合镜像源

